- scm:
    name: llvm
    scm:
        - git:
            remotes:
              - origin:
                  url: https://github.com/llvm-project/llvm-project-20170507.git
              - gerrit:
                  url: https://git-us.linaro.org/toolchain/ci/llvm-monorepo.git
            branches:
                - refs/heads/master
            basedir: llvm
            skip-tag: true
            shallow-clone: false
            wipe-workspace: false
            clean:
                before: true
            prune: true
- scm:
    name: linux
    scm:
        - git:
            remotes:
              - origin:
                  url: https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git
              - gerrit:
                  url: https://git-us.linaro.org/toolchain/linux-next.git
            branches:
                - refs/heads/master
            basedir: linux
            skip-tag: true
            shallow-clone: false
            reference-repo: /home/tcwg-buildslave/snapshots-ref/linux.git
            wipe-workspace: false
            clean:
                before: true
            prune: true
- job:
    name: tcwg-trigger-llvm-kernel-aarch64
    project-type: freestyle
    defaults: global
    properties:
        - authorization:
            anonymous:
                - job-read
                - job-extended-read
            linaro:
                - job-build
                - job-cancel
        - build-discarder:
            days-to-keep: 30
            num-to-keep: 30
    disabled: false
    node: tcwg-coordinator
    concurrent: false
    display-name: 'TCWG Trigger LLVM + Linux-next @ AArch64'
    scm:
        - llvm
        - linux
    triggers:
        # Every 5min
        - pollscm:
            cron: '*/5 * * * *'
    wrappers:
        - timeout:
            timeout: 600
        - timestamps
    builders:
        - shell: |
            #!/bin/bash
            set -e
            echo "=== Print out environment for debug purposes ==="
            env | grep "GIT"
            echo "=== Environment end  ==="
            set -x
            rm -f trigger-*
            for dir in llvm linux; do
              if [ x"$(git -C $dir branch --list --remotes --contains HEAD gerrit/linaro-local/ci/llvm-kernel-aarch64-tested)" != x"" ]; then
                continue
              fi
              echo "current_project=$dir" > trigger-$dir
            done
            echo "Going to trigger:"
            find -maxdepth 1 -name "trigger-*"
        - trigger-builds:
            - project: tcwg-rr-llvm-kernel-aarch64
              parameter-factories:
                - factory: filebuild
                  file-pattern: trigger-*
