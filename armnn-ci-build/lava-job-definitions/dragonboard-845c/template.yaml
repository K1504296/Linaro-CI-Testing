device_type: dragonboard-845c

job_name: Dragonboard-845c Debian armnn test
timeouts:
  job:
    minutes: 45
  action:
    minutes: 15
  connection:
    minutes: 2
priority: medium
visibility: public

metadata:
  source: https://git.linaro.org/lava/lava-lab.git
  path: shared/health-checks/dragonboard-845c.yaml

protocols:
  lava-lxc:
    name: lxc-test
    template: debian
    distribution: debian
    release: stretch
    arch: amd64
    mirror: http://mirror.bytemark.co.uk/debian
    verbose: true

actions:
- deploy:
    namespace: tlxc
    timeout:
      minutes: 10
    to: lxc
    packages:
    - android-tools-adb
    - android-tools-fastboot
    - systemd
    - systemd-sysv
    os: debian

- boot:
    namespace: tlxc
    prompts:
    - 'root@(.*):/#'
    - 'root@linaro-developer:~#'
    - 'root@linaro-alip:~#'
    timeout:
      minutes: 5
    method: lxc

- deploy:
    timeout:
      minutes: 8
    to: fastboot
    namespace: droid
    images:
      "partition:0":
        url: https://images.validation.linaro.org/snapshots.linaro.org/96boards/dragonboard845c/linaro/rescue/28/dragonboard-845c-bootloader-ufs-linux-28/gpt_both0.bin
      boot:
        url: http://images.validation.linaro.org/releases.linaro.org/96boards/dragonboard845c/linaro/debian/19.09/boot-linaro-buster-dragonboard-845c-58.img.gz
        compression: gz
      rootfs:
        url: http://images.validation.linaro.org/releases.linaro.org/96boards/dragonboard845c/linaro/debian/19.09/linaro-buster-alip-dragonboard-845c-58.img.gz
        compression: gz
        apply-overlay: true
    os: debian
    protocols:
        lava-lxc:
        - action: fastboot-deploy
          request: pre-power-command
          timeout:
              minutes: 2


- boot:
    namespace: droid
    prompts:
    - 'root@(.*):/#'
    - 'root@linaro-developer:~#'
    - 'root@linaro-alip:~#'
    timeout:
      minutes: 15
    method: fastboot
    protocols:
      lava-lxc:
      - action: auto-login-action
        request: pre-os-command
        timeout:
          minutes: 2
- test:
    namespace: droid
    timeout:
      minutes: 25
    definitions:
    - repository:
        metadata:
          format: Lava-Test Test Definition 1.0
          name: armnn test
          description: "armnn test"
          os:
          - debian
          scope:
          - functional
        run:
          steps:
              - dhclient
              - df -h
              - apt-get install -y ntp
              - wget https://snapshots.linaro.org/components/armnn/${BUILD_NUMBER}/armnn.tar.xz 
              - tar xf armnn.tar.xz
              - ls
              - cd home/buildslave/workspace/armnn-ci-build
              - ls
              - export BASEDIR=`pwd`
              - cd $BASEDIR/armnn/build
              - ln -s $BASEDIR/armnn/build/libprotobuf.so.15.0.0 ./libprotobuf.so.15
              - export LD_LIBRARY_PATH=`pwd`
              - chmod a+x UnitTests
              - lava-test-case ArmNN-Unit-Tests --shell ./UnitTests
      from: inline
      path: inline/armnn.yaml
      name: armnn
