- test:
    namespace: ${DEVICE_TYPE}
    timeout:
      minutes: 5
    definitions:
    - from: inline
      repository:
        metadata:
          format: Lava-Test Test Definition 1.0
          name: ssh-enable-target-login
          description: "Enable SSH Root login on Target"
        run:
          steps:
          - echo -ne "linaro123\nlinaro123\n" | passwd root
          - echo PermitRootLogin yes >> /etc/ssh/sshd_config
          - systemctl restart ssh.service
      name: ssh-enable-target-login-inline
      path: inline/ssh-enable-target-login.yaml

- test:
    namespace: tlxc
    timeout:
      minutes: 10
    definitions:
    - repository: https://git.linaro.org/lava-team/refactoring.git
      from: git
      path: testdefs/arm-probe.yaml
      name: arm-probe

- test:
    namespace: tlxc
    timeout:
      minutes: 60
    definitions:
    - from: inline
      repository:
        metadata:
          format: Lava-Test Test Definition 1.0
          name: prep-tests
          description: "Download energy-probe-ext instrumentation"
        run:
          steps:
          - apt-get update
          - apt-get -y install trace-cmd git
          - cd /root
          - git clone https://git.linaro.org/power/energy-probe-ext.git /energy-probe-ext
          - export TARGET_IP=$$(lava-target-ip)
          - echo $$TARGET_IP lava-target-ip >> /etc/hosts
      name: prep-inline
      path: inline/prep.yaml
    - repository: https://git.linaro.org/qa/test-definitions.git
      from: git
      path: automated/linux/workload-automation/workload-automation.yaml
      params:
        WA_GIT_REPO: https://github.com/alimon/workload-automation.git
        CONFIG: config/generic-linux-remote.py
        AGENDA: agenda/qcomlt/linux-workloads-db410c.yaml
        WA_EXTENSION_PATHS: /energy-probe-ext
        ARTIFACTORIAL_URL: https://archive.validation.linaro.org/artifacts/team/qcomlt/
      name: linux-pmwg

device_type: ${DEVICE_TYPE}
job_name: lt-qcom-${OS_INFO}-pmwg-${BUILD_NUMBER}
timeouts:
  job:
    minutes: 90
  action:
    minutes: 15
  connection:
    minutes: 2
priority: medium
visibility:
  group:
    - linaro

secrets:
  ARTIFACTORIAL_TOKEN: "${ARTIFACTORIAL_TOKEN}"

metadata:
  source: https://git.linaro.org/ci/job/configs.git
  path: lt-qcom/lava-job-definitions/${DEVICE_TYPE}/template-pmwg.yaml
