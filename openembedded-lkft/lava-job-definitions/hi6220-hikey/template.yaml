actions:
- command: deploy_linaro_android_image
  parameters:
    images:
    - partition: 'ptable'
      url: 'http://releases.linaro.org/reference-platform/embedded/hikey/16.12/rpb/bootloader/ptable-linux-8g.img'
    - partition: 'boot'
      url: '${BOOT_URL}'
    - partition: 'system'
      url: '${SYSTEM_URL}'
    target_type: 'ubuntu'
    login_prompt: 'hikey login'
    username: 'root'
- command: boot_linaro_image
  parameters:
    boot_cmds:
        - 'expect Start:'
        - sendline 2
        - expect CE Reference Platform
        - sendline c
        - expect grub>
        - sendline search.fs_label rootfs root
        - expect grub>
        - sendline linux ($root)/boot/Image console=tty0 console=ttyAMA3,115200 root=/dev/mmcblk0p9 rootwait rw efi=noruntime
        - expect grub>
        - sendline devicetree ($root)/boot/hi6220-hikey.dtb
        - expect grub>
        - sendline boot
    test_image_prompt: 'hikey:~#'
- command: lava_test_shell
  parameters:
    testdef_repos:
    - git-repo: git://git.linaro.org/qa/test-definitions.git
      testdef: automated/linux/kselftest/kselftest.yaml
      timeout: 3600
- command: lava_test_shell
  parameters:
    testdef_repos:
    - git-repo: git://git.linaro.org/qa/test-definitions.git
      testdef: automated/linux/ltp/ltp.yaml
      parameters:
        TST_CMDFILES: syscalls
        SKIPFILE: skipfile-lsk-juno
        SKIP_INSTALL: true
      timeout: 7200
- command: submit_results
  parameters:
    server: 'http://${LAVA_SERVER}'
    stream: '${BUNDLE_STREAM_NAME}'
device_type: '${DEVICE_TYPE}'
job_name: '${BUILD_URL}'
timeout: 9800
