actions:
- command: deploy_linaro_kernel
  parameters:
    bootloadertype: 'uefi'
    dtb: '${DTB_URL}/juno.dtb'
    kernel: '${KERNEL_URL}/Image'
    ramdisk: '${ROOTFS_BUILD_URL}'
  metadata:
    build id: '${BUILD_NUMBER}'
    distribution: 'openembedded'
    rootfs.build: '${ROOTFS_BUILD_NUMBER}'
    rootfs.type: 'minimal-initramfs-armv8b-gcc-4.9'
    git URL: '${GIT_URL}'
    git branch: '${GIT_BRANCH}'
    git commit: '${GIT_COMMIT}'
- command: boot_linaro_image
  parameters:
    boot_cmds:
    - 'expect Start:'
    - 'sendline 3'
    - 'expect Choice:'
    - 'sendline 3'
    - 'expect Delete entry:'
    - 'sendline 1'
    - 'expect Choice:'
    - 'sendline 1'
    - 'expect Select the Boot Device:'
    - 'sendcontrol ['
    - 'sendcontrol M'
    - 'expect Choice:'
    - 'expect Choice:'
    - 'sendline 1'
    - 'expect Select the Boot Device:'
    - 'sendline 8'
    - 'expect Get the IP address from DHCP: [y/n]'
    - 'sendline y'
    - 'expect Get the TFTP server IP address:'
    - 'sendline {SERVER_IP}'
    - 'expect File path of the EFI Application or the kernel'
    - 'sendline {KERNEL}'
    - 'expect Is an EFI Application? [y/n]'
    - 'sendline n'
    - 'expect Has FDT support? [y/n]'
    - 'sendline y'
    - 'expect Add an initrd: [y/n]'
    - 'sendline y'
    - 'expect Get the IP address from DHCP: [y/n]'
    - 'sendline y'
    - 'expect Get the TFTP server IP address:'
    - 'sendline {SERVER_IP}'
    - 'expect File path of the initrd'
    - 'sendline {RAMDISK}'
    - 'expect Arguments to pass to the binary:'
    - 'sendline console=ttyAMA0,115200 earlyprintk=pl011,0x7ff80000 root=/dev/ram0 verbose debug ip=dhcp'
    - 'expect Description for this new Entry:'
    - 'sendline LAVA Ramdisk Test Image'
    - 'expect Choice:'
    - 'sendline 5'
    - 'expect Select the Boot Device:'
    - 'sendcontrol ['
    - 'sendcontrol M'
    - 'expect Choice:'
    - 'expect Choice:'
    - 'sendline 5'
    - 'expect Select the Boot Device:'
    - 'sendline 8'
    - 'expect Get the IP address from DHCP: [y/n]'
    - 'sendline y'
    - 'expect Get the TFTP server IP address:'
    - 'sendline {SERVER_IP}'
    - 'expect File path of the FDT blob'
    - 'sendline {DTB}'
    - 'expect Choice:'
    - 'sendline 7'
    - 'expect Start:'
    - 'sendline 1'
- command: submit_results
  parameters:
    server: 'http://${LAVA_SERVER}'
    stream: '${BUNDLE_STREAM_NAME}'
device_type: '${DEVICE_TYPE}'
job_name: '${BUILD_URL}'
timeout: 3600
