- job:
    name: trigger-lt-qcom-linux-mainline
    project-type: freestyle
    defaults: global
    properties:
        - authorization:
            anonymous:
                - job-read
                - job-extended-read
                - job-workspace
            linaro-landing-team-qualcomm-personnel:
                - job-read
                - job-extended-read
                - job-build
                - job-cancel
        - build-discarder:
            days-to-keep: 30
            num-to-keep: 30
    parameters:
        - string:
            name: KERNEL_CI_BASE_URL
            default: 'https://storage.kernelci.org/mainline/master/'
        - string:
            name: BUILDS_URL
            default: 'https://snapshots.linaro.org/member-builds/qcomlt/linux-mainline/%s/'
    disabled: false
    node: master
    display-name: 'Trigger for LT Qualcomm Linux Mainline build'
    triggers:
        - pollurl:
            cron: 'H/5 * * * *'
            polling-node: master
            urls:
              - url: 'https://storage.kernelci.org/mainline/master/'
                check-content:
                  - simple: true
    wrappers:
        - timestamps
    builders:
        - shell: |
            #!/bin/bash

            set -ex

            pip install --user python-dateutil beautifulsoup4

            rm -rf configs
            git clone --depth 1 http://git.linaro.org/ci/job/configs.git

            python configs/trigger-lt-qcom-linux-integration/get_latest_kernel_ci_build.py \
              > lt_qcom_parameters
        - inject:
            properties-file: lt_qcom_parameters
    publishers:
        - trigger-parameterized-builds:
            - project: lt-qcom-linux-mainline
              predefined-parameters: |
                KERNEL_IMAGE_URL=${KERNEL_IMAGE_URL}
                KERNEL_MODULES_URL=${KERNEL_MODULES_URL}
                KERNEL_VERSION=${KERNEL_VERSION}
                KERNEL_DT_URL_apq8016_sbc=${KERNEL_DT_URL_apq8016_sbc}
                RAMDISK_URL_apq8016_sbc=${RAMDISK_URL_apq8016_sbc}
                ROOTFS_URL_apq8016_sbc=${ROOTFS_URL_apq8016_sbc}
                KERNEL_DT_URL_apq8096_db820c=${KERNEL_DT_URL_apq8096_db820c}
                RAMDISK_URL_apq8096_db820c=${RAMDISK_URL_apq8096_db820c}
                ROOTFS_URL_apq8096_db820c=${ROOTFS_URL_apq8096_db820c}
                KERNEL_DT_URL_sdm845_mtp=${KERNEL_DT_URL_sdm845_mtp}
                RAMDISK_URL_sdm845_mtp=${RAMDISK_URL_sdm845_mtp}
                ROOTFS_URL_sdm845_mtp=${ROOTFS_URL_sdm845_mtp}
              condition: SUCCESS
